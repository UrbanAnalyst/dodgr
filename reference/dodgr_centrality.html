<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate betweenness centrality for a 'dodgr' network. — dodgr_centrality • dodgr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate betweenness centrality for a 'dodgr' network. — dodgr_centrality"><meta name="description" content="Centrality can be calculated in either vertex- or edge-based form."><meta property="og:description" content="Centrality can be calculated in either vertex- or edge-based form."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dodgr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.028</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/UrbanAnalyst/dodgr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate betweenness centrality for a 'dodgr' network.</h1>
      <small class="dont-index">Source: <a href="https://github.com/UrbanAnalyst/dodgr/blob/main/R/centrality.R" class="external-link"><code>R/centrality.R</code></a></small>
      <div class="d-none name"><code>dodgr_centrality.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Centrality can be calculated in either vertex- or edge-based form.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dodgr_centrality</span><span class="op">(</span></span>
<span>  <span class="va">graph</span>,</span>
<span>  contract <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  edges <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"d_weighted"</span>,</span>
<span>  vert_wts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dist_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  heap <span class="op">=</span> <span class="st">"BHeap"</span>,</span>
<span>  check_graph <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-graph">graph<a class="anchor" aria-label="anchor" href="#arg-graph"></a></dt>
<dd><p>'data.frame' or equivalent object representing the network
graph (see Details)</p></dd>


<dt id="arg-contract">contract<a class="anchor" aria-label="anchor" href="#arg-contract"></a></dt>
<dd><p>If 'TRUE', centrality is calculated on contracted graph
before mapping back on to the original full graph. Note that for street
networks, in particular those obtained from the <span class="pkg">osmdata</span> package, vertex
placement is effectively arbitrary except at junctions; centrality for such
graphs should only be calculated between the latter points, and thus
'contract' should always be 'TRUE'.</p></dd>


<dt id="arg-edges">edges<a class="anchor" aria-label="anchor" href="#arg-edges"></a></dt>
<dd><p>If 'TRUE', centrality is calculated for graph edges, returning
the input 'graph' with an additional 'centrality' column; otherwise
centrality is calculated for vertices, returning the equivalent of
'dodgr_vertices(graph)', with an additional vertex-based 'centrality' column.</p></dd>


<dt id="arg-column">column<a class="anchor" aria-label="anchor" href="#arg-column"></a></dt>
<dd><p>Column of graph defining the edge properties used to calculate
centrality (see Note).</p></dd>


<dt id="arg-vert-wts">vert_wts<a class="anchor" aria-label="anchor" href="#arg-vert-wts"></a></dt>
<dd><p>Optional vector of length equal to number of vertices
(<code>nrow(dodgr_vertices(graph))</code>), to enable centrality to be calculated in
weighted form, such that centrality measured from each vertex will be
weighted by the specified amount.</p></dd>


<dt id="arg-dist-threshold">dist_threshold<a class="anchor" aria-label="anchor" href="#arg-dist-threshold"></a></dt>
<dd><p>If not 'NULL', only calculate centrality for each point
out to specified threshold. Setting values for this will result in
approximate estimates for centrality, yet with considerable gains in
computational efficiency. For sufficiently large values, approximations will
be accurate to within some constant multiplier. Appropriate values can be
established via the <a href="estimate_centrality_threshold.html">estimate_centrality_threshold</a> function.</p></dd>


<dt id="arg-heap">heap<a class="anchor" aria-label="anchor" href="#arg-heap"></a></dt>
<dd><p>Type of heap to use in priority queue. Options include
Fibonacci Heap (default; 'FHeap'), Binary Heap ('BHeap'),
Trinomial Heap ('TriHeap'), Extended Trinomial Heap
('TriHeapExt', and 2-3 Heap ('Heap23').</p></dd>


<dt id="arg-check-graph">check_graph<a class="anchor" aria-label="anchor" href="#arg-check-graph"></a></dt>
<dd><p>If <code>TRUE</code>, graph is first checked for duplicate edges,
which can cause incorrect centrality calculations. If duplicate edges are
detected in an interactive session, a prompt will ask whether you want to
proceed or rectify edges first. This value may be set to <code>FALSE</code> to skip this
check and the interactive prompt.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Modified version of graph with additional 'centrality' column added.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The <code>column</code> parameter is by default <code>d_weighted</code>, meaning centrality
is calculated by routing according to weighted distances. Other possible
values for this parameter are</p><ul><li><p><code>d</code> for unweighted distances</p></li>
<li><p><code>time</code> for unweighted time-based routing</p></li>
<li><p><code>time_weighted</code> for weighted time-based routing</p></li>
</ul><p>Centrality is calculated by default using parallel computation with the
maximal number of available cores or threads. This number can be reduced by
specifying a value via
<code>RcppParallel::setThreadOptions (numThreads = &lt;desired_number&gt;)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other centrality:
<code><a href="estimate_centrality_threshold.html">estimate_centrality_threshold</a>()</code>,
<code><a href="estimate_centrality_time.html">estimate_centrality_time</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">dodgr_centrality</span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 'graph' is then the contracted graph with an additional 'centrality' column</span></span></span>
<span class="r-in"><span><span class="co"># Same calculation via 'igraph':</span></span></span>
<span class="r-in"><span><span class="va">igr</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_to_igraph.html">dodgr_to_igraph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/betweenness.html" class="external-link">edge_betweenness</a></span> <span class="op">(</span><span class="va">igr</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span> <span class="op">(</span><span class="va">cent</span>, <span class="va">graph</span><span class="op">$</span><span class="va">centrality</span><span class="op">)</span> <span class="co"># TRUE</span></span></span>
<span class="r-in"><span><span class="co"># Values of centrality between all junctions in the contracted graph can then</span></span></span>
<span class="r-in"><span><span class="co"># be mapped back onto the original full network by "uncontracting":</span></span></span>
<span class="r-in"><span><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_uncontract_graph.html">dodgr_uncontract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># For visualisation, it is generally necessary to merge the directed edges to</span></span></span>
<span class="r-in"><span><span class="co"># form an equivalent undirected graph. Conversion to 'sf' format via</span></span></span>
<span class="r-in"><span><span class="co"># 'dodgr_to_sf()' is also useful for many visualisation routines.</span></span></span>
<span class="r-in"><span><span class="va">graph_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="dodgr_to_sf.html">dodgr_to_sf</a></span> <span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">centrality</span> <span class="op">&lt;-</span> <span class="va">graph_sf</span><span class="op">$</span><span class="va">centrality</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span> <span class="op">(</span><span class="va">graph_sf</span><span class="op">$</span><span class="va">centrality</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></span>
<span class="r-in"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"lawngreen"</span>, <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span> <span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">(</span><span class="va">ncols</span><span class="op">)</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span> <span class="op">(</span><span class="va">ncols</span> <span class="op">*</span> <span class="va">centrality</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">mapview</span> <span class="op">(</span><span class="va">graph_sf</span>, color <span class="op">=</span> <span class="va">cols</span>, lwd <span class="op">=</span> <span class="fl">10</span> <span class="op">*</span> <span class="va">centrality</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># An example of flow aggregation across a generic (non-OSM) highway,</span></span></span>
<span class="r-in"><span><span class="co"># represented as the 'routes_fast' object of the \pkg{stplanr} package,</span></span></span>
<span class="r-in"><span><span class="co"># which is a SpatialLinesDataFrame containing commuter densities along</span></span></span>
<span class="r-in"><span><span class="co"># components of a street network.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr" class="external-link">stplanr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># merge all of the 'routes_fast' lines into a single network</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">overline</span> <span class="op">(</span><span class="va">routes_fast</span>, attrib <span class="op">=</span> <span class="st">"length"</span>, buff_dist <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span> <span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Convert to a 'dodgr' network, for which we need to specify both a 'type'</span></span></span>
<span class="r-in"><span><span class="co"># and 'id' column.</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">r</span>,</span></span>
<span class="r-in"><span>    type_col <span class="op">=</span> <span class="st">"type"</span>,</span></span>
<span class="r-in"><span>    id_col <span class="op">=</span> <span class="st">"id"</span>,</span></span>
<span class="r-in"><span>    wt_profile <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># convert to contracted form, retaining junction vertices only, and append</span></span></span>
<span class="r-in"><span><span class="co"># 'centrality' column</span></span></span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">dodgr_centrality</span> <span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#' expand back to full graph; merge directed flows; and convert result to</span></span></span>
<span class="r-in"><span><span class="co"># 'sf'-format for plotting</span></span></span>
<span class="r-in"><span><span class="va">graph_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_uncontract_graph.html">dodgr_uncontract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="dodgr_to_sf.html">dodgr_to_sf</a></span> <span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span><span class="va">graph_sf</span> <span class="op">[</span><span class="st">"centrality"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Padgham, Andreas Petutschnig, David Cooley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

