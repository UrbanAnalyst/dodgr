<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dodgr • dodgr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="dodgr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dodgr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.011</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UrbanAnalyst/dodgr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>dodgr</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-08-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UrbanAnalyst/dodgr/blob/main/vignettes/dodgr.Rmd" class="external-link"><code>vignettes/dodgr.Rmd</code></a></small>
      <div class="d-none name"><code>dodgr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background-directed-graphs">1 Background: Directed Graphs<a class="anchor" aria-label="anchor" href="#background-directed-graphs"></a>
</h2>
<p><code>dodgr</code> is an <strong>R</strong> package for calculating
<strong>D</strong>istances <strong>O</strong>n <strong>D</strong>irected
<strong>Gr</strong>aphs. It does so very efficiently, and is able to
process larger graphs than many other comparable <strong>R</strong>
packages. Skip straight to the Intro if you know what directed graphs
are (but maybe make a brief stop-in to Dual-Weighted Directed Graphs
below.) Directed graphs are ones in which the “distance” (or some
equivalent measure) from A to B is not necessarily equal to that from B
to A. In Fig. 1, for example, the weights between the graph vertices (A,
B, C, and D) differ depending on the direction of travel, and it is only
possible to traverse the entire graph in an anti-clockwise
direction.</p>
<p><img src="fig1.png"></p>
<p>Graphs in <code>dodgr</code> are represented by simple flat
<code>data.frame</code> objects, so the graph of Fig. 1, presuming the
edge weights to take values of 1, 2, and 3, would be,</p>
<pre><code><span><span class="co">##   from to d</span></span>
<span><span class="co">## 1    A  B 1</span></span>
<span><span class="co">## 2    B  A 2</span></span>
<span><span class="co">## 3    B  C 1</span></span>
<span><span class="co">## 4    B  D 3</span></span>
<span><span class="co">## 5    C  B 2</span></span>
<span><span class="co">## 6    C  D 1</span></span>
<span><span class="co">## 7    D  C 2</span></span>
<span><span class="co">## 8    D  A 1</span></span></code></pre>
<p>The primary function of <code>dodgr</code> is
<code>dodgr_dists</code>, which calculates pair-wise shortest distances
between all vertices of a graph.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   A B C D</span></span>
<span><span class="co">## A 0 1 2 3</span></span>
<span><span class="co">## B 2 0 1 2</span></span>
<span><span class="co">## C 2 2 0 1</span></span>
<span><span class="co">## D 1 2 2 0</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   B C D</span></span>
<span><span class="co">## A 1 2 3</span></span>
<span><span class="co">## C 2 0 1</span></span></code></pre>
<div class="section level3">
<h3 id="dual-weighted-directed-graphs">1.1 Dual-Weighted Directed Graphs<a class="anchor" aria-label="anchor" href="#dual-weighted-directed-graphs"></a>
</h3>
<p>Shortest-path distances on weighted graphs can be calculated using a
number of other <strong>R</strong> packages, such as <a href="https://cran.r-project.org/package=igraph" class="external-link"><code>igraph</code></a>
or <a href="https://cran.r-project.org/package=e1071" class="external-link"><code>e1071</code></a>.
<code>dodgr</code> comes into its own through its ability to trace paths
through <em>dual-weighted</em> directed graphs, illustrated in Fig.
2.</p>
<p><img src="fig2.png"></p>
<p>Dual-weighted directed graphs are common in many areas, a foremost
example being routing through street networks. Routes through street
networks depends on mode of transport: the route a pedestrian might take
will generally differ markedly from the route the same person might take
if behind the wheel of an automobile. Routing through street networks
thus generally requires each edge to be specified with two weights or
distances: one quantifying the physical distance, and a second weighted
version reflecting the mode of transport (or some other preferential
weighting).</p>
<p><code>dodgr</code> calculates shortest paths using one set of weights
(called “weights” or anything else starting with “w”), but returns the
actual lengths of them using a second set of weights (called
“distances”, or anything else starting with “d”). If no weights are
specified, distances alone are used both for routing and final distance
calculations. Consider that the weights and distances of Fig. 2 are the
black and grey lines, respectively, with the latter all equal to one. In
this case, the graph and associated shortest distances are,</p>
<pre><code><span><span class="co">##   from to w d</span></span>
<span><span class="co">## 1    A  B 1 1</span></span>
<span><span class="co">## 2    B  A 2 1</span></span>
<span><span class="co">## 3    B  C 1 1</span></span>
<span><span class="co">## 4    B  D 3 1</span></span>
<span><span class="co">## 5    C  B 2 1</span></span>
<span><span class="co">## 6    C  D 1 1</span></span>
<span><span class="co">## 7    D  C 2 1</span></span>
<span><span class="co">## 8    D  A 1 1</span></span></code></pre>
<pre><code><span><span class="co">##   A B C D</span></span>
<span><span class="co">## A 0 1 2 2</span></span>
<span><span class="co">## B 1 0 1 1</span></span>
<span><span class="co">## C 2 1 0 1</span></span>
<span><span class="co">## D 1 2 1 0</span></span></code></pre>
<p>Note that even though the shortest “distance” from A to D is actually
A<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>B<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>D
with a distance of only 2, that path has a weighted distance of 1 + 3 =
4. The shortest <em>weighted</em> path is
A<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>B<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>C<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>D,
with a distance both weighted and unweighted of 1 + 1 + 1 = 3. Thus
<code>d(A,D) = 3</code> and not 2.</p>
</div>
</div>
<div class="section level2">
<h2 id="introduction-to-dodgr">2 Introduction to <code>dodgr</code><a class="anchor" aria-label="anchor" href="#introduction-to-dodgr"></a>
</h2>
<p>Although the package has been intentionally developed to be adaptable
to any kinds of networks, most of the applications illustrated here
concern street networks, and also illustrate several helper functions
the package offers for working with street networks. The basic
<code>graph</code> object of <code>dodgr</code> is nevertheless
arbitrary, and need only minimally contain three or four columns as
demonstrated in the simple examples at the outset.</p>
<p>The package may be used to calculate a matrix of distances between a
given set of geographic coordinates. We can start by simply generating
some random coordinates, in this case within the bounding box defining
the city of York in the U.K.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html" class="external-link">getbb</a></span> <span class="op">(</span><span class="st">"york uk"</span><span class="op">)</span></span>
<span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span> <span class="op">(</span><span class="va">bb</span>, <span class="fl">1</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">npts</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bb</span>; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         min        max</span></span>
<span><span class="co">## x -1.241536 -0.9215361</span></span>
<span><span class="co">## y 53.799056 54.1190555</span></span></code></pre>
<pre><code><span><span class="co">##               x        y</span></span>
<span><span class="co">## [1,] -1.1713502 53.89409</span></span>
<span><span class="co">## [2,] -1.2216108 54.01065</span></span>
<span><span class="co">## [3,] -1.0457199 53.83613</span></span>
<span><span class="co">## [4,] -0.9384666 53.93545</span></span>
<span><span class="co">## [5,] -0.9445541 53.89436</span></span>
<span><span class="co">## [6,] -1.1207099 54.01262</span></span></code></pre>
<p>The following lines download the street network within that bounding
box, weight it for pedestrian travel, and use the weighted network to
calculate the pairwise distances between all of the
<code>xy</code>points.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> <span class="op">(</span><span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">net</span>, wt_profile <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span> <span class="op">(</span></span>
<span>            <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">net</span>, from <span class="op">=</span> <span class="va">xy</span>, to <span class="op">=</span> <span class="va">xy</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  38.828   0.036   5.424</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">d</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">d</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1000 1000</span></span></code></pre>
<pre><code><span><span class="co">## [1]     0.00 57021.18</span></span></code></pre>
<p>The result is a matrix of 1000-by-1000 distances of up to 57km long,
measured along routes weighted for optimal pedestrian travel. In this
case, the single call to <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>
automatically downloaded the entire street network of York and
calculated one million shortest-path distances, all in under 30
seconds.</p>
</div>
<div class="section level2">
<h2 id="graphs-and-street-networks">3 Graphs and Street Networks<a class="anchor" aria-label="anchor" href="#graphs-and-street-networks"></a>
</h2>
<p>Although the above code is short and fast, most users will probably
want more control over their graphs and routing possibilities. To
illustrate, the remainder of this vignette analyses the much smaller
street network of Hampi, Karnataka, India, included in the
<code>dodgr</code> package as the dataset <a href="https://UrbanAnalyst.github.io/dodgr/reference/hampi.html"><code>hampi</code></a>.
This data set may be re-created with the following single line:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hampi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> <span class="op">(</span><span class="st">"hampi india"</span><span class="op">)</span></span></code></pre></div>
<p>Or with the equivalent version bundled with the package:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "sf"         "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "sfc_LINESTRING" "sfc"</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 236  15</span></span></code></pre>
<p>The <code>streetnet</code> is an <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a> (Simple
Features) object containing 189 <code>LINESTRING</code> geometries. In
other words, it’s got an <code>sf</code> representation of 189 street
segments. The <strong>R</strong> package <a href="https://docs.ropensci.org/osmplotr/" class="external-link"><code>osmplotr</code></a> can
be used to visualise this street network (with the help of
<code>magrittr</code> pipe operator, <code>%&gt;%</code>):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va">osmplotr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">osm_basemap</span> <span class="op">(</span><span class="va">hampi</span>, bg <span class="op">=</span> <span class="st">"gray95"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_osm_objects</span> <span class="op">(</span><span class="va">hampi</span>, col <span class="op">=</span> <span class="st">"gray5"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_axes</span> <span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">print_osm_map</span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hampi.png"></p>
<p>The <code>sf</code> class data representing the street network of
Hampi can then be converted into a flat <code>data.frame</code> object
by</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span>, wt_profile <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6813   15</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon   to_lat</span></span>
<span><span class="co">## 1        1       1  339318500 76.47491 15.34167  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 2        1       2  339318502 76.47612 15.34173  339318500 76.47491 15.34167</span></span>
<span><span class="co">## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621 15.34174</span></span>
<span><span class="co">## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628 15.34179</span></span>
<span><span class="co">## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621 15.34174</span></span>
<span><span class="co">##            d d_weighted highway   way_id component      time time_weighted</span></span>
<span><span class="co">## 1 130.000241 130.000241    path 28565950         1 93.600174     93.600174</span></span>
<span><span class="co">## 2 130.000241 130.000241    path 28565950         1 93.600174     93.600174</span></span>
<span><span class="co">## 3   8.890622   8.890622    path 28565950         1  6.401248      6.401248</span></span>
<span><span class="co">## 4   8.890622   8.890622    path 28565950         1  6.401248      6.401248</span></span>
<span><span class="co">## 5   9.307736   9.307736    path 28565950         1  6.701570      6.701570</span></span>
<span><span class="co">## 6   9.307736   9.307736    path 28565950         1  6.701570      6.701570</span></span></code></pre>
<p>Note that the actual graph contains around 30 times as many edges as
there are streets, indicating that each street is composed on average of
around 30 individual segments. The individual points or vertices from
those segments can be extracted with,</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">vt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            id        x        y component n</span></span>
<span><span class="co">## 1   339318500 76.47491 15.34167         1 0</span></span>
<span><span class="co">## 2   339318502 76.47612 15.34173         1 1</span></span>
<span><span class="co">## 4  2398958028 76.47621 15.34174         1 2</span></span>
<span><span class="co">## 6  1427116077 76.47628 15.34179         1 3</span></span>
<span><span class="co">## 8  7799710916 76.47634 15.34184         1 4</span></span>
<span><span class="co">## 10  339318503 76.47641 15.34190         1 5</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3337    5</span></span></code></pre>
<p>From which we see that the OpenStreetMap representation of the
streets of Hampi has 189 line segments with 2,987 unique points and
6,096 edges between those points. The number of edges per vertex in the
entire network is thus,</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2.041654</span></span></code></pre>
<p>A simple straight line has two edges between all intermediate nodes,
and this thus indicates that the network in it’s entirety is quite
simple. The <code>data.frame</code> resulting from <a href="https://UrbanAnalyst.github.io/dodgr/reference/weight_streetnet.html"><code>weight_streetnet()</code></a>
is what <code>dodgr</code> uses to calculate shortest path routes, as
will be described below, following a brief description of weighting
street networks.</p>
<div class="section level3">
<h3 id="graph-components">3.1 Graph Components<a class="anchor" aria-label="anchor" href="#graph-components"></a>
</h3>
<p>The foregoing <code>graph</code> object returned from <a href="https://UrbanAnalyst.github.io/dodgr/reference/weight_streetnet.html"><code>weight_streetnet()</code></a>
also includes a <code>$component</code> column enumerating all of the
distinct inter-connected components of the graph.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">component</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##    1    2    3 </span></span>
<span><span class="co">## 4649 2066   98</span></span></code></pre>
<p>Components are numbered in order of decreasing size, with
<code>$component = 1</code> always denoting the largest component. In
this case, that component contains 3,934 edges, representing 65% of the
graph. There are clearly only three distinct components, but this number
may be much larger for larger graphs, and may be obtained from,</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">component</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3</span></span></code></pre>
<p>Component numbers can be determined for any types of graph with the
<a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_components.html"><code>dodgr_components()</code></a>
function. For example, the following lines reduce the previous graph to
a minimal (non-spatial) structure of four columns, and then
(re-)calculate a fifth column of <code>$component</code>s:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"edge_id"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span><span class="va">graph_min</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cols</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">graph_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_components.html">dodgr_components</a></span> <span class="op">(</span><span class="va">graph_min</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">graph_min</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   edge_id    from_id      to_id          d component</span></span>
<span><span class="co">## 1       1  339318500  339318502 130.000241         1</span></span>
<span><span class="co">## 2       2  339318502  339318500 130.000241         1</span></span>
<span><span class="co">## 3       3  339318502 2398958028   8.890622         1</span></span>
<span><span class="co">## 4       4 2398958028  339318502   8.890622         1</span></span>
<span><span class="co">## 5       5 2398958028 1427116077   9.307736         1</span></span>
<span><span class="co">## 6       6 1427116077 2398958028   9.307736         1</span></span></code></pre>
<p>The <code>component</code> column column can be used to select or
filter any component in a graph. It is particularly useful to ensure
routing calculations consider only connected vertices through simply
removing all minor components:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_connected</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span><span class="va">graph</span><span class="op">$</span><span class="va">component</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p>This is explored further below (under Distance Matrices).</p>
</div>
<div class="section level3">
<h3 id="weighting-profiles">3.2 Weighting Profiles<a class="anchor" aria-label="anchor" href="#weighting-profiles"></a>
</h3>
<p>Dual-weights for street networks are generally obtained by
multiplying the distance of each segment by a weighting factor
reflecting the type of highway. As demonstrated above, this can be done
easily within <code>dodgr</code> with the <a href="https://UrbanAnalyst.github.io/dodgr/reference/weight_streetnet.html"><code>weight_streetnet()</code></a>
function, which applies the named weighting profiles included with the
<code>dodgr</code> package to OpenStreetMap networks extracted with the
<a href="https://cran.r-project.org/package=osmdata" class="external-link"><code>osmdata</code></a>
package.</p>
<p>This function uses the internal data <a href="https://UrbanAnalyst.github.io/dodgr/reference/weighting_profiles.html"><code>dodgr::weighting_profiles</code></a>,
which is a list of three items:</p>
<ol style="list-style-type: decimal">
<li>
<code>weighting_profiles</code>;</li>
<li>
<code>surface_speeds</code>; and</li>
<li><code>penalties</code></li>
</ol>
<p>Most of these data are used to calculate routing times with the
<code>dodgr_times</code> function, as detailed in an additional
vignette. The only aspects relevant for distances are the profiles
themselves, which assign preferential weights to each distinct type of
highway.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wp</span> <span class="op">&lt;-</span> <span class="va">weighting_profiles</span><span class="op">$</span><span class="va">weighting_profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">wp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "name"      "way"       "value"     "max_speed"</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span> <span class="op">(</span><span class="va">wp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span> <span class="op">(</span><span class="va">wp</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "foot"       "horse"      "wheelchair" "bicycle"    "moped"     </span></span>
<span><span class="co">##  [6] "motorcycle" "motorcar"   "goods"      "hgv"        "psv"</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wp</span> <span class="op">[</span><span class="va">wp</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"foot"</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    name            way value max_speed</span></span>
<span><span class="co">## 1  foot       motorway  0.00        NA</span></span>
<span><span class="co">## 2  foot          trunk  0.40        NA</span></span>
<span><span class="co">## 3  foot        primary  0.50         5</span></span>
<span><span class="co">## 4  foot      secondary  0.60         5</span></span>
<span><span class="co">## 5  foot       tertiary  0.70         5</span></span>
<span><span class="co">## 6  foot   unclassified  0.80         5</span></span>
<span><span class="co">## 7  foot    residential  0.90         5</span></span>
<span><span class="co">## 8  foot        service  0.90         5</span></span>
<span><span class="co">## 9  foot          track  0.95         5</span></span>
<span><span class="co">## 10 foot       cycleway  0.95         5</span></span>
<span><span class="co">## 11 foot           path  1.00         5</span></span>
<span><span class="co">## 12 foot          steps  0.80         2</span></span>
<span><span class="co">## 13 foot          ferry  0.20         5</span></span>
<span><span class="co">## 14 foot  living_street  0.95         5</span></span>
<span><span class="co">## 15 foot      bridleway  1.00         5</span></span>
<span><span class="co">## 16 foot        footway  1.00         5</span></span>
<span><span class="co">## 17 foot     pedestrian  1.00         5</span></span>
<span><span class="co">## 18 foot  motorway_link  0.00        NA</span></span>
<span><span class="co">## 19 foot     trunk_link  0.40        NA</span></span>
<span><span class="co">## 20 foot   primary_link  0.50         5</span></span>
<span><span class="co">## 21 foot secondary_link  0.60         5</span></span>
<span><span class="co">## 22 foot  tertiary_link  0.70         5</span></span></code></pre>
<p>Each profile is defined by a series of percentage weights quantifying
highway-type preferences for a particular mode of travel. The distinct
types of highways within the Hampi graph obtained above can be tabulated
with:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## living_street          path       primary   residential     secondary </span></span>
<span><span class="co">##            20          3557           430           196           560 </span></span>
<span><span class="co">##       service         steps         track  unclassified </span></span>
<span><span class="co">##           256           108           914           772</span></span></code></pre>
<p>Hampi is unlike most other human settlements on the planet in being a
Unesco World Heritage area in which automobiles are generally
prohibited. Accordingly, numbers of <code>"footway"</code>,
<code>"path"</code>, and <code>"pedestrian"</code> ways far exceed
typical categories denoting automobile traffic
(<code>"primary", "residential", "tertiary"</code>)</p>
<p>It is also possible to use other types of (non-OpenStreetMap) street
networks, an example of which is the <a href="https://UrbanAnalyst.github.io/dodgr/reference/os_roads_bristol.html"><code>os_roads_bristol</code></a>
data provided with the package. “OS” is the U.K. Ordnance Survey, and
these data are provided as a Simple Features (<a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>)
<code>data.frame</code> with a decidedly different structure to
<code>osmdata data.frame</code> objects:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">)</span> <span class="co"># many fields manually removed to reduce size of this object</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "osm_id"        "bicycle"       "covered"       "foot"         </span></span>
<span><span class="co">##  [5] "highway"       "incline"       "motorcar"      "motorcycle"   </span></span>
<span><span class="co">##  [9] "motor_vehicle" "oneway"        "surface"       "tracktype"    </span></span>
<span><span class="co">## [13] "tunnel"        "width"         "geometry"</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">os_roads_bristol</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "fictitious" "identifier" "class"      "roadNumber" "name1"     </span></span>
<span><span class="co">##  [6] "name1_lang" "name2"      "name2_lang" "formOfWay"  "length"    </span></span>
<span><span class="co">## [11] "primary"    "trunkRoad"  "loop"       "startNode"  "endNode"   </span></span>
<span><span class="co">## [16] "structure"  "nameTOID"   "numberTOID" "function."  "geometry"</span></span></code></pre>
<p>The latter may be converted to a <code>dodgr</code> network by first
specifying a weighting profile, here based on the <code>formOfWay</code>
column:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colnm</span> <span class="op">&lt;-</span> <span class="st">"formOfWay"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span> <span class="op">(</span><span class="va">os_roads_bristol</span> <span class="op">[[</span><span class="va">colnm</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Collapsed Dual Carriageway           Dual Carriageway </span></span>
<span><span class="co">##                         14                          6 </span></span>
<span><span class="co">##         Single Carriageway                  Slip Road </span></span>
<span><span class="co">##                          1                          8</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>                   way <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span> <span class="op">(</span><span class="va">os_roads_bristol</span> <span class="op">[[</span><span class="va">colnm</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">os_roads_bristol</span>, wt_profile <span class="op">=</span> <span class="va">wts</span>,</span>
<span>                         type_col <span class="op">=</span> <span class="va">colnm</span>, id_col <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span></span></code></pre></div>
<p>The resultant <code>net</code> object contains the street network of
<a href="https://UrbanAnalyst.github.io/dodgr/reference/os_roads_bristol.html"><code>os_roads_bristol</code></a>
weighted by the specified profile, and in a format suitable for
submission to any <code>dodgr</code> routine.</p>
</div>
<div class="section level3">
<h3 id="random-sub-graphs">3.3 Random Sub-Graphs<a class="anchor" aria-label="anchor" href="#random-sub-graphs"></a>
</h3>
<p>The <code>dodgr</code> packages includes a function to select a
random connected portion of graph including a specified number of
vertices. This function is used in the <a href="https://UrbanAnalyst.github.io/dodgr/reference/compare_heaps.html"><code>compare_heaps()</code></a>
function described below, but is also useful for general statistical
analyses of large graphs which may otherwise take too long to
compute.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_sample.html">dodgr_sample</a></span> <span class="op">(</span><span class="va">graph</span>, nverts <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph_sub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 199</span></span></code></pre>
<p>The random sample has around twice as many edges as vertices, in
accordance with the statistics calculated above.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph_sub</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="distance-matrices-dodgr_dists">4 Distance Matrices: <code>dodgr_dists()</code><a class="anchor" aria-label="anchor" href="#distance-matrices-dodgr_dists"></a>
</h2>
<p>As demonstrated at the outset, an entire network can simply be
submitted to <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>,
in which case a square matrix will be returned containing pair-wise
distances between all vertices. Doing that for the <code>graph</code> of
York will return a square matrix of around 90,000-times-90,000 (or 8
billion) distances. It might be possible to do that on some computers,
but is possibly neither recommended nor desirable. The <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>
function accepts additional arguments of <code>from</code> and
<code>to</code> defining points from and to which distances are to be
calculated. If only <code>from</code> is provided, a square matrix is
returned of pair-wise distances between all listed points.</p>
<div class="section level3">
<h3 id="aligning-routing-points-to-graphs">4.1 Aligning Routing Points to Graphs<a class="anchor" aria-label="anchor" href="#aligning-routing-points-to-graphs"></a>
</h3>
<p>For spatial graphs—that is, those containing columns of latitudes and
longitudes (or “x” and “y”)—routing points can be represented by a
simple matrix of arbitrary latitudes and longitudes (or, again, “x” and
“y”). <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>
will map these points to the closest network points, and return
corresponding shortest-path distances. This may be illustrated by
generating random points within the bounding box of the above map of
Hampi. As demonstrated above, the coordinates of all vertices may be
extracted with the <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_vertices.html"><code>dodgr_vertices()</code></a>
function, enabling random points to be generated with the following
lines:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of points to generate</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">vt</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Submitting these to <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>
as points <strong>from</strong> which to route will generate a distance
matrix from each of these 100 points to every other point in the
graph:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">xy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">d</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">d</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  100 3337</span></span></code></pre>
<pre><code><span><span class="co">## [1]     0.00 14926.04</span></span></code></pre>
<p>If the <code>to</code> argument is also specified, the matrix
returned will have rows matching <code>from</code> and columns matching
<code>to</code></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">xy</span>, to <span class="op">=</span> <span class="va">xy</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100  10</span></span></code></pre>
<p>Some of the resultant distances in the above cases are
<code>NA</code> because the points were sampled from the entire bounding
box, and the street network near the boundaries may be cut off from the
rest. As demonstrated above, the <a href="https://UrbanAnalyst.github.io/dodgr/reference/weight_streetnet.html"><code>weight_streetnet()</code></a>
function returns a <code>component</code> vector, and such disconnected
edges will have <code>graph$component &gt; 1</code>, because
<code>graph$component == 1</code> always denotes the largest connected
component. This means that the graph can always be reduced to the single
largest component with the following single line:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_connected</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span><span class="va">graph</span><span class="op">$</span><span class="va">component</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p>A distance matrix obtained from running <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances</code></a>
on <code>graph_connected</code> should generally contain no
<code>NA</code> values, although some points may still be effectively
unreachable due to one-way connections (or streets). Thus, routing on
the largest connected component of a directed graph ought to be expected
to yield the <em>minimal</em> number of <code>NA</code> values, which
may sometimes be more than zero. Note further that spatial routing
points (expressed as <code>from</code> and/or <code>to</code> arguments)
will in this case be mapped to the nearest vertices of
<code>graph_connected</code>, rather than the potentially closer nearest
points of the full <code>graph</code>. This may make the spatial mapping
of routing points less accurate than results obtained by repeating
extraction of the street network using an expanded bounding box. For
automatic extraction of street networks with <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>,
the extent by which the bounding box exceeds the range of routing points
(<code>from</code> and <code>to</code> arguments) is determined by an
extra parameter <code>expand</code>, quantifying the relative extent to
which the bounding box should exceed the spatial range of the routing
points. This is illustrated in the following code which calculates
distances between 100 random points:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html" class="external-link">getbb</a></span> <span class="op">(</span><span class="st">"york uk"</span><span class="op">)</span></span>
<span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span> <span class="op">(</span><span class="va">bb</span>, <span class="fl">1</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">npts</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">routed_points</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">expand</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">pts</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">gr0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> <span class="op">(</span>pts <span class="op">=</span> <span class="va">pts</span>, expand <span class="op">=</span> <span class="va">expand</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">d0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">gr0</span>, from <span class="op">=</span> <span class="va">pts</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span> <span class="op">(</span><span class="va">d0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">d0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">routed_points</span> <span class="op">(</span><span class="va">i</span>, pts <span class="op">=</span> <span class="va">xy</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.04007477 0.02326452 0.02131992 0.00000000</span></span></code></pre>
<p>With a street network that precisely encompasses the submitted
routing points (<code>expand = 0</code>), 4% of pairwise distances are
unable to be calculated; with a bounding box expanded to 5% larger than
the submitted points, this is reduced to 2.3%, and with expansion to
20%, all points can be connected.</p>
<p>For non-spatial graphs, <code>from</code> and <code>to</code> must
match precisely on to vertices named in the graph itself. In the graph
considered above, these vertex names were contained in the columns,
<code>from_id</code> and <code>to_id</code>. The minimum that a
<code>dodgr</code> graph requires is,</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">graph</span> <span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      from_id      to_id          d</span></span>
<span><span class="co">## 1  339318500  339318502 130.000241</span></span>
<span><span class="co">## 2  339318502  339318500 130.000241</span></span>
<span><span class="co">## 3  339318502 2398958028   8.890622</span></span>
<span><span class="co">## 4 2398958028  339318502   8.890622</span></span>
<span><span class="co">## 5 2398958028 1427116077   9.307736</span></span>
<span><span class="co">## 6 1427116077 2398958028   9.307736</span></span></code></pre>
<p>in which case the <code>from</code> values submitted to
<code><a href="../reference/dodgr_dists.html">dodgr_dists()</a></code> (and <code>to</code>, if given) must directly
name the vertices in the <code>from_id</code> and <code>to_id</code>
columns of the graph. This is illustrated in the following code:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_min</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph_min</span><span class="op">$</span><span class="va">from_id</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># 10 random points</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph_min</span><span class="op">$</span><span class="va">to_id</span>, size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph_min</span>, from <span class="op">=</span> <span class="va">fr</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10 20</span></span></code></pre>
<p>The result is a 10-by-20 matrix of distances between these named
graph vertices.</p>
</div>
<div class="section level3">
<h3 id="shortest-path-calculations-priority-queues">4.2 Shortest Path Calculations: Priority Queues<a class="anchor" aria-label="anchor" href="#shortest-path-calculations-priority-queues"></a>
</h3>
<p><code>dodgr</code> uses an internal library <span class="citation">Shane Saunders (2004)</span> for the calculation of
shortest paths using a variety of priority queues <span class="citation">(see Miller 1960 for an overview)</span>. In the
context of shortest paths, priority queues determine the order in which
a graph is traversed <span class="citation">(Tarjan 1983)</span>, and
the choice of priority queue can have a considerable effect on
computational efficiency for different kinds of graphs <span class="citation">(Johnson 1977)</span>. In contrast to
<code>dodgr</code>, most other <strong>R</strong> packages for shortest
path calculations do not use priority queues, and so may often be less
efficient. Shortest path distances can be calculated in
<code>dodgr</code> with priority queues that use the following
heaps:</p>
<ol style="list-style-type: decimal">
<li>Binary heaps;</li>
<li>Fibonacci heaps <span class="citation">(Fredman and Tarjan
1987)</span>;</li>
<li>Trinomial and extended trinomial heaps <span class="citation">(Takaoka 2000)</span>; and</li>
<li>2-3 heaps <span class="citation">(Takaoka 1999)</span>.</li>
</ol>
<p>Differences in how these heaps operate are often largely extraneous
to direct application of routing algorithms, even though heap choice may
strongly affect performance. To avoid users needing to know anything
about algorithmic details, <code>dodgr</code> provides a function <a href="https://UrbanAnalyst.github.io/dodgr/reference/compare_heaps.html"><code>compare_heaps()</code></a>
to which a particular graph may be submitted in order to determine the
optimal kind of heap.</p>
<p>The comparisons are actually made on a randomly selected
sub-component of the graph containing a defined number of vertices (with
a default of 1,000, or the entire graph if it contains fewer than 1,000
vertices).</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_heaps.html">compare_heaps</a></span> <span class="op">(</span><span class="va">graph</span>, nverts <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: bench</span></span></code></pre>
<pre><code><span><span class="co">## Loading required namespace: igraph</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 11 × 6</span></span></span>
<span><span class="co">##    expression                 min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> BHeap                   1.96ms   2.01ms      496.    45.9KB     15.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> FHeap                   1.96ms   2.03ms      490.    45.9KB     15.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> TriHeap                 1.97ms   2.05ms      486.    45.9KB     17.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> TriHeapExt              1.78ms   1.84ms      535.    48.9KB     17.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Heap23                  1.95ms   2.03ms      491.    45.9KB     15.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> BHeap_contracted        1.75ms   1.82ms      548.      19KB     19.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> FHeap_contracted        1.75ms   1.83ms      547.      19KB     17.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> TriHeap_contracted      1.75ms   1.83ms      543.      19KB     17.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> TriHeapExt_contracted    1.5ms   1.56ms      629.      19KB     19.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Heap23_contracted       1.75ms   1.83ms      543.      19KB     19.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> igraph                579.65µs 607.92µs     <span style="text-decoration: underline;">1</span>624.   336.7KB     21.5</span></span></code></pre>
<p>The key column of that <code>data.frame</code> is
<code>relative</code>, which quantifies the relative performance of each
test in relation to the best which is given a score of 1.
<code>dodgr</code> using the default <code>heap = "BHeap"</code>, which
is a binary heap priority queue, performs faster than <a href="https://igraph.org" class="external-link"><code>igraph</code></a> <span class="citation">(Csardi and Nepusz 2006)</span> for these graphs.
Different kind of graphs will perform differently with different
priority queue structures, and this function enables users to
empirically discern the optimal heap for their kind of graph.</p>
<p>Note, however, that this is not an entirely fair comparison, because
<code>dodgr</code> calculates dual-weighted distances, whereas <a href="https://igraph.org" class="external-link"><code>igraph</code></a>—and indeed all other
<strong>R</strong> packages—only directly calculate distances based on a
single set of weights. Implementing dual-weighted routing in these cases
requires explicitly re-tracing all paths and summing the second set of
weights along each path. A time comparison in that case would be very
strongly in favour of <code>dodgr</code>. Moreover, <code>dodgr</code>
can convert graphs to contracted form through removing redundant
vertices, as detailed in the following section. Doing so greatly
improves performance with respect to <a href="https://igraph.org" class="external-link"><code>igraph</code></a>.</p>
<p>For those wishing to do explicit comparisons themselves, the
following code generates the <a href="https://igraph.org" class="external-link"><code>igraph</code></a> equivalent of <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>,
although of course for single-weighted graphs only:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">id</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">igr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_to_igraph.html">dodgr_to_igraph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/distances.html" class="external-link">distances</a></span> <span class="op">(</span><span class="va">igr</span>, v <span class="op">=</span> <span class="va">pts</span>, to <span class="op">=</span> <span class="va">pts</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="graph-contraction">5 Graph Contraction<a class="anchor" aria-label="anchor" href="#graph-contraction"></a>
</h2>
<p>A further unique feature of <code>dodgr</code> is the ability to
remove redundant vertices from graphs (see Fig. 3), thereby speeding up
routing calculations.</p>
<p><img src="fig3.png"></p>
<p>In Fig. 3(A), the only way to get from vertex 1 to 3, 4 or 5 is
through C. The intermediate vertex B is redundant for routing purposes
(and than to or from that precise point) and may simply be removed, with
directional edges inserted directly between vertices 1 and 3. This
yields the equivalent contracted graph of Fig. 3(B), in which, for
example, the distance (or weight) between 1 and 3 is the sum of previous
distances (or weights) between 1
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
2 and 2
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>→</mo><annotation encoding="application/x-tex">\to</annotation></semantics></math>
3. Note that if one of the two edges between, say, 3 and 2 were removed,
vertex 2 would no longer be redundant (Fig. 3(C)).</p>
<p>Different kinds of graphs have different degrees of redundancy, and
even street networks differ, through for example dense inner-urban
networks generally being less redundant than less dense extra-urban or
rural networks. The contracted version of a graph can be obtained with
the function <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_contract_graph.html"><code>dodgr_contract_graph()</code></a>,
illustrated here with the York example from above.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<p>The function <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_contract_graph.html"><code>dodgr_contract_graph()</code></a>
returns the contracted version of the original graph, containing the
same number of columns, but with each row representing an edge between
two junction vertices (or between the submitted <code>verts</code>,
which may or may not be junctions). Relative sizes are</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6813</span></span></code></pre>
<pre><code><span><span class="co">## [1] 876</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0.1285777</span></span></code></pre>
<p>equivalent to the removal of around 90% of all edges. The difference
in routing efficiency can then be seen with the following code</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">$</span><span class="va">from_id</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">$</span><span class="va">to_id</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span> <span class="op">(</span></span>
<span>    full <span class="op">=</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>,</span>
<span>    contracted <span class="op">=</span> <span class="fu"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> <span class="op">(</span><span class="va">grc</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>,</span>
<span>    check <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># numeric rounding errors can lead to differences</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> full        12.48ms  13.29ms      75.9    1.24MB     2.05</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> contracted   2.74ms   2.89ms     340.   297.09KB     2.03</span></span></code></pre>
<p>And contracting the graph has a similar effect of speeding up
pairwise routing between these 100 points. All routing algorithms scale
non-linearly with size, and relative improvements in efficiency will be
even greater for larger graphs.</p>
<div class="section level3">
<h3 id="routing-on-contracted-graphs">5.1 Routing on Contracted Graphs<a class="anchor" aria-label="anchor" href="#routing-on-contracted-graphs"></a>
</h3>
<p>Routing is often desired between defined points, and these points may
inadvertently be removed in graph contraction. The <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_contract_graph.html"><code>dodgr_contract_graph()</code></a>
function accepts an additional argument specifying vertices to keep
within the contracted graph. This list of vertices must directly match
the vertex ID values in the graph.</p>
<p>The following code illustrates how to retain specific vertices within
contracted graphs:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 876</span></span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">verts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">id</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">verts</span><span class="op">)</span> <span class="co"># a character vector</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2627465897" "8618022288" "2627436884" "1204772874" "3921517060"</span></span>
<span><span class="co">## [6] "2398957887"</span></span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph</span>, <span class="va">verts</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">grc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 990</span></span></code></pre>
<p>Retaining the nominated vertices yields a graph with considerably
more edges than the fully contracted graph excluding these vertices. The
<a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances()</code></a>
function can be applied to the latter graph to obtain accurate distances
precisely routed between these points, yet using the speed advantages of
graph contraction.</p>
</div>
</div>
<div class="section level2">
<h2 id="shortest-paths">6 Shortest Paths<a class="anchor" aria-label="anchor" href="#shortest-paths"></a>
</h2>
<p>Shortest paths can also be extracted with the <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_paths.html"><code>dodgr_paths()</code></a>
function. For given vectors of <code>from</code> and <code>to</code>
points, this returns a nested list so that if,</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_paths.html">dodgr_paths</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></span></code></pre></div>
<p>then <code>dp [[i]] [[j]]</code> will contain the path from
<code>from [i]</code> to <code>to [j]</code>. The paths are represented
as sequences of vertex names. Consider the following example,</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span>, wt_profile <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon   to_lat</span></span>
<span><span class="co">## 1        1       1  339318500 76.47491 15.34167  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 2        1       2  339318502 76.47612 15.34173  339318500 76.47491 15.34167</span></span>
<span><span class="co">## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621 15.34174</span></span>
<span><span class="co">## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628 15.34179</span></span>
<span><span class="co">## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621 15.34174</span></span>
<span><span class="co">##            d d_weighted highway   way_id component      time time_weighted</span></span>
<span><span class="co">## 1 130.000241 130.000241    path 28565950         1 93.600174     93.600174</span></span>
<span><span class="co">## 2 130.000241 130.000241    path 28565950         1 93.600174     93.600174</span></span>
<span><span class="co">## 3   8.890622   8.890622    path 28565950         1  6.401248      6.401248</span></span>
<span><span class="co">## 4   8.890622   8.890622    path 28565950         1  6.401248      6.401248</span></span>
<span><span class="co">## 5   9.307736   9.307736    path 28565950         1  6.701570      6.701570</span></span>
<span><span class="co">## 6   9.307736   9.307736    path 28565950         1  6.701570      6.701570</span></span></code></pre>
<p>The columns of <code>from_id</code> and <code>to_id</code> contain
the names of the vertices. To extract shortest paths between some of
these, first take some small samples of <code>from</code> and
<code>to</code> points, and submit them to <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_paths.html"><code>dodgr_paths()</code></a>:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">from_id</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">to_id</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_paths.html">dodgr_paths</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">dp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<p>The result (<code>dp</code>) is a list of 10 items, each of which
contains 5 vectors. An example is,</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dp</span> <span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1] "7794251379" "2588155758" "7794251378" "7794251377" "7794251376"</span></span>
<span><span class="co">##   [6] "2588155745" "7794251375" "7794251374" "2588155759" "7794251373"</span></span>
<span><span class="co">##  [11] "7794251372" "2588155721" "2588155728" "2588155748" "7794251371"</span></span>
<span><span class="co">##  [16] "7794251370" "2588155708" "2588155743" "7794251369" "7794251368"</span></span>
<span><span class="co">##  [21] "7794251367" "2588155725" "2588155741" "7794251366" "7794251365"</span></span>
<span><span class="co">##  [26] "2588155773" "2588155737" "7794251364" "7794251363" "7794251362"</span></span>
<span><span class="co">##  [31] "2588155717" "7794251361" "7794251360" "7794251359" "7794251358"</span></span>
<span><span class="co">##  [36] "2588155727" "2588155731" "7794251357" "2588155730" "7794251356"</span></span>
<span><span class="co">##  [41] "7794251355" "7794251354" "2588155760" "7794251353" "7794251352"</span></span>
<span><span class="co">##  [46] "2588155732" "7794251351" "7794251350" "7794251349" "7794251348"</span></span>
<span><span class="co">##  [51] "2588155734" "7794251347" "2588155765" "7794251345" "7794251346"</span></span>
<span><span class="co">##  [56] "7794251344" "2588155767" "7794251343" "7794251342" "7794251341"</span></span>
<span><span class="co">##  [61] "2588155751" "2588155724" "7794251340" "7794251339" "7794251338"</span></span>
<span><span class="co">##  [66] "2588155756" "7794251337" "2588155772" "2588155763" "7794251336"</span></span>
<span><span class="co">##  [71] "7794251335" "2588155747" "2588155707" "2588155729" "2588155746"</span></span>
<span><span class="co">##  [76] "2588155713" "2588155719" "7794251333" "7794251334" "2588155704"</span></span>
<span><span class="co">##  [81] "2588155723" "2588155711" "2588155757" "2588155716" "2588155777"</span></span>
<span><span class="co">##  [86] "2588155750" "2588155754" "2588155755" "2588155712" "2588155779"</span></span>
<span><span class="co">##  [91] "2588155771" "2588155718" "2588155703" "2588155714" "2588155776"</span></span>
<span><span class="co">##  [96] "2588155740" "2588155778" "2588155726" "2588155706" "2588155705"</span></span>
<span><span class="co">## [101] "2398957796" "2398957797" "2398957798" "340148006"  "340148007" </span></span>
<span><span class="co">## [106] "2398957809" "2398957814" "286632895"  "1390214618" "2398957831"</span></span>
<span><span class="co">## [111] "2398957835" "286632896"  "2398957838" "1604033309" "2398957841"</span></span>
<span><span class="co">## [116] "2398957842" "2398957844" "338512693"  "2627477006" "4035136503"</span></span>
<span><span class="co">## [121] "4035136504" "4035136505" "4035136506" "4035136507" "4035136508"</span></span>
<span><span class="co">## [126] "4035136509" "4035136510" "4035136511" "4035136512" "4035136513"</span></span>
<span><span class="co">## [131] "4035136514" "4035136515" "4035136516" "4035136517" "4035136527"</span></span>
<span><span class="co">## [136] "4035136518" "4035136519" "4035136520" "4035136521" "4035136522"</span></span>
<span><span class="co">## [141] "4035136525" "8616917034" "2398957817" "1054865512" "2398957821"</span></span>
<span><span class="co">## [146] "2398957822" "338904633"  "2398957824" "338904630"  "1148815092"</span></span>
<span><span class="co">## [151] "2398957827" "2398957829" "338904628"  "2398957830" "1054866750"</span></span>
<span><span class="co">## [156] "2398957833" "1148815271" "2398957836" "1148814749"</span></span></code></pre>
<p>For spatial graphs, the coordinates of these paths can be obtained by
extracting the vertices with <code><a href="../reference/dodgr_vertices.html">dodgr_vertices()</a></code> and matching
the vertex IDs:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">verts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="va">path1</span> <span class="op">&lt;-</span> <span class="va">verts</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span> <span class="op">(</span><span class="va">dp</span> <span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">verts</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">path1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              id        x        y component    n</span></span>
<span><span class="co">## 3664 7794251379 76.43803 15.32648         1 1838</span></span>
<span><span class="co">## 3666 2588155758 76.43829 15.32639         1 1839</span></span>
<span><span class="co">## 3668 7794251378 76.43845 15.32631         1 1840</span></span>
<span><span class="co">## 3670 7794251377 76.43872 15.32621         1 1841</span></span>
<span><span class="co">## 3672 7794251376 76.43891 15.32619         1 1842</span></span>
<span><span class="co">## 3674 2588155745 76.43914 15.32618         1 1843</span></span></code></pre>
<p>Paths calculated on contracted graphs will of course have fewer
vertices than those calculated on full graphs.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Csardi2006" class="csl-entry">
Csardi, Gabor, and Tamas Nepusz. 2006. <span>“The Igraph Software
Package for Complex Network Research.”</span> <em>InterJournal</em>
Complex Systems: 1695. <a href="https://igraph.org" class="external-link">https://igraph.org</a>.
</div>
<div id="ref-Fredman1987" class="csl-entry">
Fredman, Michael L., and Robert Endre Tarjan. 1987. <span>“Fibonacci
Heaps and Their Uses in Improved Network Optimization
Algorithms.”</span> <em>J. ACM</em> 34 (3): 596–615. <a href="https://doi.org/10.1145/28869.28874" class="external-link">https://doi.org/10.1145/28869.28874</a>.
</div>
<div id="ref-Johnson1977" class="csl-entry">
Johnson, Donald B. 1977. <span>“Efficient Algorithms for Shortest Paths
in Sparse Networks.”</span> <em>J. ACM</em> 24 (1): 1–13. <a href="https://doi.org/10.1145/321992.321993" class="external-link">https://doi.org/10.1145/321992.321993</a>.
</div>
<div id="ref-Miller1960" class="csl-entry">
Miller, Rupert G. 1960. <span>“Priority Queues.”</span> <em>The Annals
of Mathematical Statistics</em> 31 (1): 86–103. <a href="https://projecteuclid.org/journals/annals-of-mathematical-statistics/volume-31/issue-1/Priority-Queues/10.1214/aoms/1177705990.full" class="external-link">https://projecteuclid.org/journals/annals-of-mathematical-statistics/volume-31/issue-1/Priority-Queues/10.1214/aoms/1177705990.full</a>.
</div>
<div id="ref-Saunders2004" class="csl-entry">
Saunders, Shane. 2004. <span>“Improved Shortest Path Algorithms for
Nearly Acyclic Graphs.”</span> PhD thesis, Department of Computer
Science; Software Engineering, University of Canterbury, New Zealand.
</div>
<div id="ref-Saunders2003" class="csl-entry">
Saunders, S., and T. Takaoka. 2003. <span>“Improved Shortest Path
Algorithms for Nearly Acyclic Graphs.”</span> <em>Theoretical Computer
Science</em> 293 (3): 535--556.
</div>
<div id="ref-Takaoka1999" class="csl-entry">
Takaoka, Tadao. 1999. <span>“Theory of 2-3 Heaps.”</span> In
<em>Computing and Combinatorics: 5th Annual International Conference,
COCOON’99 Tokyo, Japan, July 26–28, 1999 Proceedings</em>, edited by
Takano Asano, Hideki Imai, D. T. Lee, Shin-ichi Nakano, and Takeshi
Tokuyama, 41–50. Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/3-540-48686-0_4" class="external-link">https://doi.org/10.1007/3-540-48686-0_4</a>.
</div>
<div id="ref-Takaoka2000" class="csl-entry">
———. 2000. <span>“Theory of Trinomial Heaps.”</span> In <em>Computing
and Combinatorics: 6th Annual International Conference, COCOON 2000
Sydney, Australia, July 26–28, 2000 Proceedings</em>, edited by Ding-Zhu
Du, Peter Eades, Vladimir Estivill-Castro, Xuemin Lin, and Arun Sharma,
362–72. Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/3-540-44968-X_36" class="external-link">https://doi.org/10.1007/3-540-44968-X_36</a>.
</div>
<div id="ref-Tarjan1983" class="csl-entry">
Tarjan, R. 1983. <em>Data Structures and Network Algorithms</em>.
Society for Industrial; Applied Mathematics. <a href="https://doi.org/10.1137/1.9781611970265" class="external-link">https://doi.org/10.1137/1.9781611970265</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Padgham, Andreas Petutschnig, David Cooley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
