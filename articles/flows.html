<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dodgr flows • dodgr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="dodgr flows">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dodgr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.3.007</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UrbanAnalyst/dodgr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>dodgr flows</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2025-09-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UrbanAnalyst/dodgr/blob/main/vignettes/flows.Rmd" class="external-link"><code>vignettes/flows.Rmd</code></a></small>
      <div class="d-none name"><code>flows.Rmd</code></div>
    </div>

    
    
<p>The <code>dodgr</code>package includes three functions for allocating
and aggregating flows throughout network, based on defined properties of
a set of origin and destination points. The three primary functions for
flows are <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_aggregate()</code></a>,
<a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_disperse.html"><code>dodgr_flows_disperse()</code></a>,
and <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_si.html"><code>dodgr_flows_si()</code></a>,
each of which is now described in detail.</p>
<div class="section level2">
<h2 id="flow-aggregation">1 Flow Aggregation<a class="anchor" aria-label="anchor" href="#flow-aggregation"></a>
</h2>
<p>The first of the above functions aggregates ‘’flows’’ throughout a
network from a set of origin (<code>from</code>) and destination
(<code>to</code>) points. Flows commonly arise in origin-destination
matrices used in transport studies, but may be any kind of generic flows
on graphs. A flow matrix specifies the flow between each pair of origin
and destination points, and the <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_aggregate()</code></a>
function aggregates all of these flows throughout a network and assigns
a resultant aggregate flow to each edge.</p>
<p>For a set of <code>nf</code> points of origin and <code>nt</code>
points of destination, flows are defined by a simple
<code>nf</code>-by-<code>nt</code> matrix of values, as in the following
code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span>, wt_profile <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">from_id</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">$</span><span class="va">to_id</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">from</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">to</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">from</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This <code>flows</code> matrix is then submitted to <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_aggregate()</code></a>,
which simply appends an additional column of <code>flows</code> to the
submitted <code>graph</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span>, flows <span class="op">=</span> <span class="va">flows</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon   to_lat</span></span>
<span><span class="co">## 1        1       1  339318500 76.47491 15.34167  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 2        1       2  339318502 76.47612 15.34173  339318500 76.47491 15.34167</span></span>
<span><span class="co">## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621 15.34174</span></span>
<span><span class="co">## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612 15.34173</span></span>
<span><span class="co">## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628 15.34179</span></span>
<span><span class="co">## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621 15.34174</span></span>
<span><span class="co">##            d d_weighted highway   way_id component      time time_weighted flow</span></span>
<span><span class="co">## 1 129.761207 129.761207    path 28565950         1 93.428069     93.428069    0</span></span>
<span><span class="co">## 2 129.761207 129.761207    path 28565950         1 93.428069     93.428069    0</span></span>
<span><span class="co">## 3   8.874244   8.874244    path 28565950         1  6.389455      6.389455    0</span></span>
<span><span class="co">## 4   8.874244   8.874244    path 28565950         1  6.389455      6.389455    0</span></span>
<span><span class="co">## 5   9.311222   9.311222    path 28565950         1  6.704080      6.704080    0</span></span>
<span><span class="co">## 6   9.311222   9.311222    path 28565950         1  6.704080      6.704080    0</span></span></code></pre>
<p>Most flows are zero because they have only been calculated between
very few points in the graph.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">$</span><span class="va">flow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##  0.0000  0.0000  0.0000  0.3164  0.0000  5.1291</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="flow-dispersal">2 Flow Dispersal<a class="anchor" aria-label="anchor" href="#flow-dispersal"></a>
</h2>
<p>The second function, <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_disperse.html"><code>dodgr_flows_disperse()</code></a>,
uses only a vector a origin (<code>from</code>) points, and aggregates
flows as they disperse throughout the network according to a simple
exponential model. In place of the matrix of flows required by <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_aggregate()</code></a>,
dispersal requires an equivalent vector of densities dispersing from all
origin (<code>from</code>) points. This is illustrated in the following
code, using the same graph as the previous example.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">from</span><span class="op">)</span><span class="op">)</span> <span class="co"># uniform densities</span></span>
<span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_flows_disperse.html">dodgr_flows_disperse</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, dens <span class="op">=</span> <span class="va">dens</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">$</span><span class="va">flow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">## 0.000e+00 0.000e+00 7.549e-05 8.658e-03 1.010e-02 1.587e-01</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="merging-directed-flows">3 Merging directed flows<a class="anchor" aria-label="anchor" href="#merging-directed-flows"></a>
</h2>
<p>Note that flows from both <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_aggregate()</code></a>
and <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code>dodgr_flows_disperse()</code></a>
are <em>directed</em>, so the flow from ‘A’ to ‘B’ will not necessarily
equal the flow from ‘B’ to ‘A’. It is often desirable to aggregate flows
in an undirected manner, for example for visualisations where plotting
pairs of directed flows between each edge if often not feasible for
large graphs. Directed flows can be aggregated to equivalent undirected
flows with the <code><a href="../reference/merge_directed_graph.html">merge_directed_graph()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_undir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">)</span></span></code></pre></div>
<p>Resultant graphs produced by <a href="https://UrbanAnalyst.github.io/dodgr/reference/merge_directed_graph.html"><code>merge_directed_graph()</code></a>
only include those edges having non-zero flows, and so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6813</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">graph_undir</span><span class="op">)</span> <span class="co"># the latter is much smaller</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3069</span></span></code></pre>
<p>The resultant graph can readily be merged with the original graph to
regain the original data on vertex coordinates through</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span><span class="va">graph_undir</span><span class="op">$</span><span class="va">edge_id</span>, <span class="op">]</span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="va">flow</span> <span class="op">&lt;-</span> <span class="va">graph_undir</span><span class="op">$</span><span class="va">flow</span></span></code></pre></div>
<p>This graph may then be used to visualise flows with the <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flowmap.html"><code>dodgr_flowmap()</code></a>
function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="va">graph_f</span> <span class="op">[</span><span class="va">graph_f</span><span class="op">$</span><span class="va">flow</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="../reference/dodgr_flowmap.html">dodgr_flowmap</a></span> <span class="op">(</span><span class="va">graph_f</span>, linescale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="hampi-flowmap.png"></p>
</div>
<div class="section level2">
<h2 id="flows-from-spatial-interaction-models">4. Flows from spatial interaction models<a class="anchor" aria-label="anchor" href="#flows-from-spatial-interaction-models"></a>
</h2>
<p>An additional function, <a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_flows_si.html"><code>dodgr_flows_si()</code></a>
enables flows to be aggregated according to exponential spatial
interaction models. The function is called just as the
<code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code> call demonstrated above, but
without the <code>flows</code> matrix specifying strengths of flows
between each pair of points.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_flows_si.html">dodgr_flows_si</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></span>
<span><span class="va">graph_undir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">)</span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span><span class="va">graph_undir</span><span class="op">$</span><span class="va">edge_id</span>, <span class="op">]</span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="va">flow</span> <span class="op">&lt;-</span> <span class="va">graph_undir</span><span class="op">$</span><span class="va">flow</span></span>
<span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="va">graph_f</span> <span class="op">[</span><span class="va">graph_f</span><span class="op">$</span><span class="va">flow</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="../reference/dodgr_flowmap.html">dodgr_flowmap</a></span> <span class="op">(</span><span class="va">graph_f</span>, linescale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="hampi-flowmap2.png"></p>
<p>Flows in that graph are are notably lower than in the previous one,
because that previous one aggregated flows between all pairs of points
with no attenuation. Spatial interaction models attenuate both
attraction based on how far apart two points are, as well as flows along
paths between those points based on an exponential decay model. The
documentation for that function describes the several ways this
attenuation can be controlled, the easiest of which is via a single
numeric value. Reducing the attenuation gives the following result:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span>, wt_profile <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span></span>
<span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dodgr_flows_si.html">dodgr_flows_si</a></span> <span class="op">(</span><span class="va">graph</span>, from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span>, k <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span><span class="va">graph_undir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="va">graph_f</span><span class="op">)</span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va">graph</span> <span class="op">[</span><span class="va">graph_undir</span><span class="op">$</span><span class="va">edge_id</span>, <span class="op">]</span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="va">flow</span> <span class="op">&lt;-</span> <span class="va">graph_undir</span><span class="op">$</span><span class="va">flow</span></span>
<span><span class="va">graph_f</span> <span class="op">&lt;-</span> <span class="va">graph_f</span> <span class="op">[</span><span class="va">graph_f</span><span class="op">$</span><span class="va">flow</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="../reference/dodgr_flowmap.html">dodgr_flowmap</a></span> <span class="op">(</span><span class="va">graph_f</span>, linescale <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="hampi-flowmap3.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Padgham, Andreas Petutschnig, David Cooley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
